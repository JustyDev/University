# Flutter приложение с авторизацией через Яндекс ID

Приложение демонстрирует интеграцию авторизации через Яндекс ID с сохранением сессии.

## Возможности

- ✅ Авторизация через Яндекс ID (OAuth 2.0)
- ✅ Кнопка "Войти через Яндекс"
- ✅ Отображение профиля пользователя
- ✅ Кнопка "Выход"
- ✅ Сохранение сессии локально (автоматический вход)
- ✅ Поддержка iOS

## Настройка

### 1. Регистрация приложения в Яндекс OAuth

1. Перейдите на https://oauth.yandex.ru
2. Нажмите "Зарегистрировать новое приложение"
3. Заполните форму:
   - **Название**: Любое название вашего приложения
   - **Платформы**: Выберите "Мобильное приложение"
   - **Callback URL**: `lab3app://oauth`
4. В разделе "Доступ к данным" выберите права:
   - `login:info` - Доступ к логину, имени и фамилии, полу
   - `login:email` - Доступ к адресу электронной почты
   - `login:avatar` - Доступ к аватару пользователя
5. Сохраните приложение
6. Скопируйте **Client ID** и **Client Secret**

### 2. Настройка кода приложения

Откройте файл `lib/services/yandex_auth_service.dart` и замените значения:

```dart
static const String clientId = 'YOUR_CLIENT_ID'; // Ваш Client ID
static const String clientSecret = 'YOUR_CLIENT_SECRET'; // Ваш Client Secret
```

**ВАЖНО:** В реальном приложении не храните Client Secret в коде! Используйте серверную часть для обмена кода на токен.

### 3. Установка зависимостей

```bash
flutter pub get
```

### 4. Настройка iOS (уже выполнено)

В файле `ios/Runner/Info.plist` уже добавлены необходимые настройки:
- URL Scheme: `lab3app`
- Поддержка Яндекс OAuth

## Запуск приложения

### iOS Simulator

```bash
flutter run -d ios
```

### iOS Device

1. Подключите устройство
2. Настройте signing в Xcode
3. Запустите:
```bash
flutter run -d <device-id>
```

## Как работает приложение

### Процесс авторизации

1. **Пользователь нажимает "Войти через Яндекс"**
   - Приложение открывает страницу авторизации Яндекс в браузере
   - URL: `https://oauth.yandex.ru/authorize?response_type=code&client_id=...`

2. **Пользователь авторизуется на сайте Яндекс**
   - Вводит логин и пароль
   - Подтверждает доступ к данным

3. **Яндекс перенаправляет обратно в приложение**
   - URL: `lab3app://oauth?code=AUTHORIZATION_CODE`
   - Приложение перехватывает этот URL через Deep Link

4. **Приложение обменивает код на токен**
   - Отправляет POST запрос на `https://oauth.yandex.ru/token`
   - Получает `access_token` и `refresh_token`

5. **Приложение получает данные пользователя**
   - Отправляет GET запрос на `https://login.yandex.ru/info`
   - Получает профиль пользователя (имя, email, аватар и т.д.)

6. **Сохранение сессии**
   - Токены и данные пользователя сохраняются в SharedPreferences
   - При следующем запуске приложение проверяет наличие токена
   - Если токен есть - автоматически переходит на главный экран

### Структура проекта

```
lib/
├── main.dart                          # Точка входа, роутинг, Deep Links
├── models/
│   └── user_model.dart               # Модель данных пользователя
├── screens/
│   ├── login_screen.dart             # Экран входа с кнопкой авторизации
│   └── home_screen.dart              # Главный экран с профилем пользователя
└── services/
    └── yandex_auth_service.dart      # Сервис для работы с Яндекс OAuth
```

### Используемые пакеты

- **http** - HTTP запросы к API Яндекс
- **url_launcher** - Открытие страницы авторизации в браузере
- **uni_links** - Обработка Deep Links для возврата из браузера
- **shared_preferences** - Локальное хранение токенов и данных пользователя

## Безопасность

⚠️ **Важные замечания по безопасности:**

1. **Client Secret** в коде - это упрощение для демонстрации. В продакшене:
   - Используйте Backend for Frontend (BFF) паттерн
   - Обмен кода на токен должен происходить на сервере
   - Client Secret должен храниться на сервере, а не в приложении

2. **Refresh Token**:
   - Реализуйте автоматическое обновление токена при истечении
   - Используйте Refresh Token для получения нового Access Token

3. **HTTPS**:
   - Все запросы к API должны использовать HTTPS

## Тестирование

1. Запустите приложение
2. Нажмите "Войти через Яндекс"
3. Авторизуйтесь в Яндекс (если еще не авторизованы)
4. Подтвердите доступ к данным
5. Вы будете перенаправлены обратно в приложение
6. Проверьте отображение профиля
7. Закройте приложение и откройте снова - вы должны автоматически попасть на главный экран (сессия сохранена)
8. Нажмите "Выход" для выхода из аккаунта

## Возможные проблемы и решения

### Deep Link не работает

- Убедитесь, что в `Info.plist` правильно настроен URL Scheme
- Проверьте, что Callback URL в настройках Яндекс OAuth совпадает с `lab3app://oauth`
- Для iOS может потребоваться добавление Associated Domains в capabilities

### Ошибка при получении токена

- Проверьте правильность Client ID и Client Secret
- Убедитесь, что Callback URL совпадает
- Проверьте права доступа в настройках приложения на oauth.yandex.ru

### Аватар не отображается

- Убедитесь, что в настройках OAuth выбрано право `login:avatar`
- Проверьте интернет-соединение

## Дополнительная информация

- [Документация Яндекс OAuth](https://yandex.ru/dev/id/doc/ru/)
- [Flutter Deep Linking](https://docs.flutter.dev/development/ui/navigation/deep-linking)
- [OAuth 2.0 RFC](https://tools.ietf.org/html/rfc6749)

## Лицензия

MIT
